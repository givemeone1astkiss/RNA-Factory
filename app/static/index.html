<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNA-Factory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/bpfold.css" rel="stylesheet">
    <link href="/static/css/ufold.css" rel="stylesheet">
    <link href="/static/css/mxfold2.css" rel="stylesheet">
    <link href="/static/css/rnaformer.css" rel="stylesheet">
    <link href="/static/css/rnamigos2.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Page -->
    <div class="loading-page" id="loadingPage">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fas fa-dna"></i>
            </div>
        </div>
    </div>

    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <div class="brand-logo">
                    <i class="fas fa-dna"></i>
                    <span>RNA-Factory</span>
                </div>
            </a>
            <div class="navbar-nav">
                <div class="ai-assistant-toggle">
                    <button class="btn btn-outline-light btn-sm" id="aiAssistantToggle" onclick="toggleAIAssistant()">
                        <i class="fas fa-robot"></i>
                        <span>AI Assistant</span>
                    </button>
                </div>
                <div class="theme-toggle">
                    <button class="btn btn-outline-light btn-sm" id="themeToggle" onclick="toggleTheme()">
                        <i class="fas fa-moon" id="themeIcon"></i>
                        <span id="themeText">Dark Mode</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- AI Assistant Sidebar -->
        <div class="ai-sidebar" id="aiSidebar">
            <div class="ai-sidebar-header">
                <div class="ai-header-content">
                    <button class="ai-close-btn" onclick="toggleAIAssistant()" title="Close AI Assistant">
                        <i class="fas fa-times"></i>
                    </button>
                    <h5>AI Assistant</h5>
                    <i class="fas fa-robot"></i>
                </div>
                <div class="ai-status">
                    <span class="status-indicator" id="aiStatusIndicator"></span>
                    <span class="status-text" id="aiStatusText">Ready</span>
                </div>
            </div>
            
            <div class="ai-chat-container">
                <div class="ai-chat-messages" id="aiChatMessages">
                    <div class="ai-message ai-assistant">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <p>Hello! I'm your AI assistant powered by DeepSeek. I can help you with RNA analysis, model explanations, and answer your questions about bioinformatics. How can I assist you today?</p>
                        </div>
                    </div>
                </div>
                
                <div class="ai-chat-input">
                    <div class="ai-input-container">
                        <textarea class="ai-input-field" id="aiMessageInput" placeholder="Type your message here..." rows="1"></textarea>
                        <button class="ai-send-btn" id="aiSendButton" onclick="sendAIMessage()" title="Send Message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="model-tabs" id="modelTabs">
                <!-- Model tabs will be generated dynamically via JavaScript -->
            </div>
        </div>

        <div class="main-content">
            <div class="content-header" id="contentHeader">
                <div class="header-content">
                    <h1 id="currentModelTitle">Welcome to RNA-Factory</h1>
                    <p id="currentModelDesc" class="text-muted">Please select a model from the left sidebar to begin analysis</p>
                    
                    <!-- Model Links Section -->
                    <div class="model-links" id="modelLinks" style="display: none;">
                        <div class="links-container">
                            <a href="#" id="githubLink" class="model-link github-link" target="_blank" style="display: none;">
                                <i class="fab fa-github"></i>
                                <span>GitHub Repository</span>
                            </a>
                            <a href="#" id="paperLink" class="model-link paper-link" target="_blank" style="display: none;">
                                <i class="fas fa-file-alt"></i>
                                <span>Research Paper</span>
                            </a>
                        </div>
                    </div>

                    <!-- Model Architecture Section -->
                    <div class="model-architecture" id="modelArchitecture" style="display: none;">
                        <div class="architecture-header">
                            <i class="fas fa-project-diagram"></i>
                            <h6>Model Architecture</h6>
                        </div>
                        <div class="architecture-content">
                            <div class="architecture-image-container">
                                <img id="architectureImage" src="" alt="Model Architecture" style="display: none;">
                                <div id="architecturePlaceholder" class="architecture-placeholder">
                                    <i class="fas fa-image"></i>
                                    <p>No architecture image available</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section" id="inputSection" style="display: none;">
                <div class="input-card">
                    <div class="card-header">
                        <i class="fas fa-upload"></i>
                        <h5>Input Data</h5>
                    </div>
                    <div class="card-body">
                        <div class="input-methods">
                            <!-- File Upload -->
                            <div class="input-method" id="generalFileUpload">
                                <div class="method-header">
                                    <i class="fas fa-file-upload"></i>
                                    <h6>Upload File</h6>
                                </div>
                                <div class="file-upload-area" id="fileUploadArea">
                                    <div class="upload-content">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click or drag files here</p>
                                        <small id="fileAcceptInfo">Supports FASTA, TXT formats</small>
                                        <input type="file" id="inputFile" accept=".fasta,.fa,.txt" style="display: none;">
                                    </div>
                                </div>
                                <div id="fileInfo" class="file-info" style="display: none;"></div>
                            </div>

                            <!-- Text Input -->
                            <div class="input-method" id="generalTextInput">
                                <div class="method-header">
                                    <i class="fas fa-keyboard"></i>
                                    <h6>Text Input</h6>
                                </div>
                                <div class="text-input-area">
                                    <textarea id="inputText" rows="6" placeholder="Enter RNA sequence (A, C, G, U) or other text data..."></textarea>
                                </div>
                            </div>

                            <!-- Structure Prediction Options -->
                            <div class="input-method bpfold-options" id="bpfoldOptions" style="display: none;">
                                <div class="method-header">
                                    <i class="fas fa-cog"></i>
                                    <h6>Options</h6>
                                </div>
                                <div class="options-area">
                                    <div class="form-group">
                                        <label class="form-check-label">
                                            <input type="checkbox" id="ignoreNonCanonical" class="form-check-input">
                                            <span class="checkmark"></span>
                                            <span id="optionLabel">Ignore non-canonical base pairs</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- RNAmigos2 Specific Input Area -->
                            <div class="input-method rnamigos2-input" id="rnamigos2Input" style="display: none;">
                                <!-- Structure Input Section -->
                                <div class="rnamigos2-section">
                                    <div class="method-header">
                                        <i class="fas fa-cube"></i>
                                        <h6>RNA Structure (mmCIF)</h6>
                                    </div>
                                    <div class="file-upload-area" id="rnamigos2FileUpload">
                                        <div class="upload-content">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Click or drag mmCIF files here</p>
                                            <small>CIF, mmCIF supported</small>
                                            <input type="file" id="rnamigos2FileInput" accept=".cif,.mmcif" style="display: none;">
                                        </div>
                                    </div>
                                </div>

                                <!-- Binding Site Section -->
                                <div class="rnamigos2-section">
                                    <div class="method-header">
                                        <i class="fas fa-bullseye"></i>
                                        <h6>Binding Site Residues</h6>
                                    </div>
                                    <div class="input-row">
                                        <div class="residue-input-area">
                                            <textarea id="rnamigos2Residues" rows="5" placeholder="Enter residue identifiers, one per line or comma-separated&#10;Example:&#10;A.20&#10;A.19&#10;A.18"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ligands Section -->
                                <div class="rnamigos2-section smiles-section">
                                    <div class="method-header">
                                        <i class="fas fa-flask"></i>
                                        <h6>Ligand SMILES</h6>
                                    </div>
                                    <div class="input-row">
                                        <div class="file-upload-area" id="rnamigos2SmilesFileUpload">
                                            <div class="upload-content">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Click or drag SMILES files here</p>
                                                <small>TXT supported</small>
                                                <input type="file" id="rnamigos2SmilesFileInput" accept=".txt" style="display: none;">
                                            </div>
                                        </div>
                                        <div class="text-input-area">
                                            <textarea id="rnamigos2SmilesText" rows="6" placeholder="Enter SMILES strings, one per line&#10;Example:&#10;CCC[S@](=O)c1ccc2[nH]/c(=N\C(=O)OC)[nH]c2c1&#10;O=C(O)[C@@H](O)c1ccccc1"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-lg" id="runAnalysisBtn" onclick="runAnalysis()">
                                <i class="fas fa-play"></i>
                                <span>Start Analysis</span>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="clearInputs()">
                                <i class="fas fa-eraser"></i>
                                <span>Clear Input</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Display Section - Now positioned below input section -->
            <div class="result-section" id="resultSection" style="display: none;">
                <div class="result-card">
                    <div class="card-header">
                        <i class="fas fa-chart-bar"></i>
                        <h5>Analysis Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="resultContent">
                            <div class="no-results-placeholder">
                                <i class="fas fa-chart-line"></i>
                                <p>No results yet. Run an analysis to see results here.</p>
                            </div>
                        </div>
                        <div id="downloadActions" class="download-actions" style="display: none;">
                            <button class="btn btn-primary" onclick="downloadAllResults()">
                                <i class="fas fa-download"></i> Download Results
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div class="history-section" id="historySection" style="display: none;">
                <div class="history-card">
                    <div class="card-header">
                        <i class="fas fa-history"></i>
                        <h5>Analysis History</h5>
                        <div class="header-actions">
                            <button class="btn btn-sm btn-outline-danger" onclick="clearHistory()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="historyContent">
                            <!-- History content will be generated dynamically via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Markdown rendering libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Custom JS -->
    <script src="/static/js/app.js"></script>
    <script>
        // Application will be initialized by app.js
    </script>
</body>
</html>
